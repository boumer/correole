#!/usr/bin/env ruby

require 'sinatra/base'
require 'active_record'
require 'correole'
require 'subscriber'

logger = Logger.new(STDERR)

ENV["RACK_ENV"] = ENV["CORREOLE_ENV"] || "production"
logger.info("Environment is #{ENV["RACK_ENV"]}")

database_file = "#{Dir.pwd}/config/database.yml"
ActiveRecord::Base.configurations = YAML.load(ERB.new(File.read(database_file)).result)
ActiveRecord::Base.establish_connection

Correole.run!
